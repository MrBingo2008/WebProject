<div id="recordContain">
<div class="unitBox">
	<form id="pagerForm" method="post" onsubmit="return divSearch(this, 'recordContain');" action="v_record_multi_list.do?type=${type!}">
		<input type="hidden" name="searchName" value="${searchName!}"/>
	</form>
	<div class="pageHeader" style="border:1px #B8D0D6 solid">
		<form onsubmit="return divSearch(this, 'recordContain');" action="v_record_multi_list.do?type=${type!}" method="post">
		<div class="searchBar">
			<table class="searchContent">
				<tr>
				<#if type == 0>
					<td><@s.m "sell.order"/>: ${order.info!}</td>
					<td><div class="button"><div class="buttonContent"><button id="selectButton" type="button" onclick="closeAndSelect();"><@s.m "global.select"/></button></div></td>
				<#else>
					<td>
						<label><@s.m "orderOrMaterial"/>：</label><input type="text" name="searchName" value="${searchName!}"/>
					</td>
					<td>
						<div class="buttonActive"><div class="buttonContent"><button type="submit"><@s.m "global.query"/></button></div></div>
					    <div class="button"><div class="buttonContent"><button type="button" multLookup="checkboxIds" warn="请选择成品"><@s.m "global.select"/></button></div></div>
					</td>
				</#if>
				</tr>
			</table>
		</div>
		</form>
	</div>
	
	<div class="pageContent" style="border-left:1px #B8D0D6 solid;border-right:1px #B8D0D6 solid;border-bottom:1px #B8D0D6 solid">
		<table class="table" width="99%" layoutH="66">
			<thead>
				<tr>
					<th width="30"><input type="checkbox" class="checkboxCtrl" group="checkboxIds" /></th>
					<th width="100" orderField="number" class="asc"><@s.m "product.serial"/></th>
					<th width="100"><@s.m "product.name"/></th>
					<#if type != 1>
						<th width="60"><@s.m "sell.order.surface"/></th>
					</#if>
					<th width="80"><@s.m "${orderType}.order.company"/></th>
					<th width="140"><@s.m "${orderType}.order.serial"/></th>
					<th width="100"><@s.m "${orderType}.order.number"/></th>
					<th width="100"><@s.m "${orderType}.order.notFinishNumber"/></th>
					<th width="40"><@s.m "material.unit"/></th>			
				</tr>
			</thead>
			<tbody>
			<#list records as record>
				<tr target="sid_obj" rel="1">
				    <td><input type="checkbox" name="checkboxIds" value="{'ids':'${record.id}', infos:'${record.fullInfo!}', number:${record.notFinishNumber!}, 'material.id':'${record.material.id}', 'material.nameSpec':'${record.material.nameSpec!}'}"/></td>
					<td>${record.material.allSerial!}</td>
					<td>${record.material.info!}</td>
					<#if type != 1>
						<td>${(record.surface.name)!}</td>
					</#if>
					<td>${record.ord.company.name!}</td>
					<td>${record.ord.serial!}</td>
					<td>${record.number!}</td>
					<td>${record.notFinishNumber!}</td>
					<td>${record.material.unit!}</td>
				</tr>
			</#list>
			</tbody>
		</table>
	</div>
</div>
<div id="sidebarH" style="height:0px; display:none">
	<div class="sidebarHeader">
		<div class="sidebarHeaderContent">
			<h1 style="">物料批次</h1>
			<a class="icon-button close"></a>
		</div>
	</div>
	<div id="sidebarContentH" class="sidebarContentH" style="height: 155px">
	</div>
</div>
</div>

<script type="text/javascript">
$(function(){
	if ($.fn.jBarH) {
		$("#recordContain").jBarH({minW:150, maxW:700});
	}
});

function closeAndSelect(){
	var recordIdString = "", numberString = "";
	var $unitBox = $("#selectButton").parents(".unitBox:first");
	$unitBox.find("[name='checkboxIds']").filter(":checked").each(function(){
		var _args = DWZ.jsonEval($(this).val());
		for (var key in _args) {
			//modified by stone,写死了
			if(key =="ids"){
				var temp = recordIdString ? recordIdString+"," : "";
				recordIdString = temp + _args[key];
			}else if(key =="number"){
				var temp = numberString ? numberString+"," : "";
				numberString = temp + _args[key];
			}
		}
	});

	if (recordIdString == null || recordIdString == "") {
		alertMsg.error("请选择订单产品");
		return false;
	}
	
	$.pdialog.close("dialog_plan_todo_select");
	$.pdialog.open("v_plan_todo_list.do?recordIdString="+recordIdString+"&numberString="+numberString, "dialog_plan_todo_list", "<@s.m 'plan.todo.list'/>", {width:300, height:200, align:"bottomLeft", close:"function(){ajaxTodo('o_plan_todo_clear.do');}"});
	
}
</script>
