<script type="text/javascript">
$(function(){
	if('${openMode!}' == 'edit'){
		var actionUrl = "o_process_update.do";
		$("form").attr("action", actionUrl);
	}
});
</script>
<div class="pageContent">
	<form method="post" action="o_process_save.do" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone);">
		<div class="pageFormContent" layoutH="56">
			<p>
				<label>ID:</label>
				<input name="id" type="text" size="20" value="${process.id!}" readonly="readonly"/>
			</p>
			<p>
				<label><@s.m "process.serial" />:</label>
				<input name="serial" class="required" type="text" size="20" value="${process.serial!}"/>
			</p>
			<p>
				<label><@s.m "process.name"/>:</label>
				<input name="name" type="text" size="20" value="${process.name!}"/>
			</p>
			<p>
				<label><@s.m "process.applyCategory"/>:</label>
				<input type="hidden" name="category.id" value="${(process.category.id)!}"/>
				<input type="text" class="required" name="category.name" value="${(process.category.name)!}" readonly/>
				<a class="btnLook" href="v_category_tree.do?parentId=1" lookupGroup="category"><@s.m "process.applyCategory"/></a>		
			</p>
			<p>
				<label><@s.m "process.comment"/>:</label>
				<input name="comment" type="text" size="20" value="${process.comment!}"/>
			</p>
			<div class="divider"></div>
			<div class="panel" style="overflow: auto;">
				<h1><@s.m "process.items"/></h1>
            	<div>
				<table class="list nowrap itemDetail" addButton="<@s.m 'process.addItem'/>" width="100%">
					<thead>
						<tr>
							<th type="label" size="2" display="#index#"><@s.m "global.number"/></th>			
							<th type="lookup" name="steps[#index#].serial" size="20" fieldClass="textInput required"
								lookupGroup="steps[#index#]" lookupUrl="v_step_list.do?type=0" aTitle="<@s.m 'step'/>"><@s.m "step.serial"/></th>
							<th type="text" name="steps[#index#].name" size="20"><@s.m "step.name"/></th>
							<th type="enum" name="steps[#index#].type"
								enumUrl="<select class='combox'>
									<option value='0'><@s.m 'step.type.0'/></option>
									<option value='1'><@s.m 'step.type.1'/></option></select>" 
									size="12"><@s.m "step.type"/></th>						
							<th type="del" width="60"><@s.m "global.operate"/></th>
						</tr>
					</thead>
					<tbody>
					<#if process.steps??>
						<#assign count=0 />
						<#list process.steps as step>
						<tr class="unitBox">
						    <td><span class="label" display="#index#">${count+1}</span>
						    <input type="hidden" name="steps[${count}].id" value="${step.id}"></input></td>
							<td>
								<input type="text" name="steps[${count}].serial" value="${step.serial!}" size="20" class="textInput required">
								<a class="btnLook" href="v_step_list.do?type=0" lookupgroup="steps[${count}]" lookuppk="id" title="<@s.m 'step'/>"><@s.m 'step'/></a>
							</td>
							<td><input type="text" name="steps[${count}].name" value="${step.name!}" size="20" class="textInput">
							<td>
								<select class='combox' name='steps[${count}].type'>
									<option value='0' <#if step.type == 0>selected="selected"</#if>><@s.m 'step.type.0'/></option>
									<option value='1' <#if step.type == 1>selected="selected"</#if>><@s.m 'step.type.1'/></option>
								</select>
							</td> 
							<td><a href="javascript:void(0)" class="btnDel"><@s.m "global.delete"/></a></td>
						</tr>
						<#assign count=count+1/>
						</#list>
					</#if>
					</tbody>
				</table>
				</div>
			</div>
		</div>
		<div class="formBar">
			<ul>
				<li><div class="buttonActive"><div class="buttonContent"><button type="submit">保存</button></div></div></li>
				<li><div class="button"><div class="buttonContent"><a title="<@s.m 'process'/>" href="v_process_list.do" target="navTab" rel="main"><button type="button" class="close">取消</button></a></div></div></li>
			</ul>
		</div>
	</form>
</div>
